<html>
    <head>
        <title>Pod Controller Experiment</title>
        <link rel="stylesheet" href="../css/stylesheet.css">
    </head>
    <body onload="update()">
        <div class = creation>
            <button id="create" onclick="createPod();update()">CREATE POD!</button>
        </div>
        <div>
            <table id="table">
                <tr>
                    <td id="td-main">Pod ID</td><td>Pod IP</td><td>Pod Domain Name</td><td><button id="delete" onclick="deletePod();update()">Delete</button></td>
                </tr>
            </table>
        </div>
    </body>
    <script>
        var knownPods = []
        
        var ip = "localhost";
        var port = 3001;

        function getBackendPath () {
            return "http://" + ip + ":" + port;
        }

        async function createPod () {
            await fetch(getBackendPath() + "/createpod", {
                method: "POST"
            })
        }

        async function deletePod (id, name) {
            await fetch(getBackendPath() + "/deletepod", {
                method: "DELETE",
                body: JSON.stringify({id, name}),
                headers: {
                    "Content-Type": "application/json"
                }
            })
        }

        async function fetchPods () {
            let result = {};

            let response = await fetch(getBackendPath() + "/pods", {
                method: "GET"
            });

            return JSON.parse(response.body);
        }

        function update () {
            fetchPods().then((pods) => {
                knownPods = pods
                rebuildPodTable();
            })
        }

        function rebuildPodTable () {
            let table = document.getElementById("table");
            let html = "";

            for (pod in knownPods) {
                html += buildPodRow(pod);
            }

            table.innerHTML = html;
        }

        function buildPodRow (pod) {
            return "<tr><td id=\"td-main\">" + pod.id + "</td><td>" + pod.ip + "</td><td>" + pod.domainName + "</td><td><button id=\"delete\" onclick=\"deletePod()\">Delete</button></td></tr>"
        }
    </script>
</html>